(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(555)}])},555:function(e,t,r){"use strict";let n;r.r(t),r.d(t,{currentRPMAtom:function(){return N},default:function(){return T}});var l=r(5893);let o=0,i=e=>"init"in e,a=e=>!!e.write,s=new WeakMap,u=(e,t)=>{s.set(e,t),e.catch(()=>{}).finally(()=>s.delete(e))},d=(e,t)=>{let r=s.get(e);r&&(s.delete(e),r(t))},c=(e,t)=>{e.status="fulfilled",e.value=t},f=(e,t)=>{e.status="rejected",e.reason=t},h=e=>"function"==typeof(null==e?void 0:e.then),v=(e,t)=>"v"in e&&"v"in t&&Object.is(e.v,t.v),g=(e,t)=>"e"in e&&"e"in t&&Object.is(e.e,t.e),w=e=>"v"in e&&e.v instanceof Promise,_=(e,t)=>"v"in e&&"v"in t&&e.v.orig&&e.v.orig===t.v.orig,b=e=>{if("e"in e)throw e.e;return e.v},p=()=>{let e,t;let r=new WeakMap,n=new WeakMap,l=new Map;e=new Set,t=new Set;let o=e=>r.get(e),s=(e,t)=>{Object.freeze(t);let n=r.get(e);if(r.set(e,t),l.has(e)||l.set(e,n),n&&w(n)){let e="v"in t?t.v instanceof Promise?t.v:Promise.resolve(t.v):Promise.reject(t.e);d(n.v,e)}},p=(e,t,r)=>{let n=new Map,l=!1;r.forEach((r,o)=>{r||o!==e||(r=t),r?(n.set(o,r),t.d.get(o)!==r&&(l=!0)):console.warn("[Bug] atom state not found")}),(l||t.d.size!==n.size)&&(t.d=n)},m=(e,t,r)=>{let n=o(e),l={d:(null==n?void 0:n.d)||new Map,v:t};if(r&&p(e,l,r),n&&v(n,l)&&n.d===l.d)return n;if(n&&w(n)&&w(l)&&_(n,l)){if(n.d===l.d)return n;l.v=n.v}return s(e,l),l},E=(e,t,r,l)=>{if(h(t)){let i;let a=new Promise((l,s)=>{let u=!1;t.then(t=>{if(!u){u=!0;let i=o(e),s=m(e,a,r);c(a,t),l(t),n.has(e)&&(null==i?void 0:i.d)!==s.d&&A(e,s,null==i?void 0:i.d)}},t=>{if(!u){u=!0;let l=o(e),i=m(e,a,r);f(a,t),s(t),n.has(e)&&(null==l?void 0:l.d)!==i.d&&A(e,i,null==l?void 0:l.d)}}),i=e=>{u||(u=!0,e.then(e=>c(a,e),e=>f(a,e)),l(e))}});return a.orig=t,a.status="pending",u(a,e=>{e&&i(e),null==l||l()}),m(e,a,r)}return m(e,t,r)},y=(e,t,r)=>{let n=o(e),l={d:(null==n?void 0:n.d)||new Map,e:t};return(r&&p(e,l,r),n&&g(n,l)&&n.d===l.d)?n:(s(e,l),l)},S=(e,t)=>{let r,l;let s=o(e);if(!t&&s&&(n.has(e)||Array.from(s.d).every(([t,r])=>t===e||S(t)===r)))return s;let u=new Map,d=!0;try{let t=e.read(t=>{if(t===e){let e=o(t);if(e)return u.set(t,e),b(e);if(i(t))return u.set(t,void 0),t.init;throw Error("no atom init")}let r=S(t);return u.set(t,r),b(r)},{get signal(){return r||(r=new AbortController),r.signal},get setSelf(){return a(e)||console.warn("setSelf function cannot be used with read-only atom"),!l&&a(e)&&(l=(...t)=>{if(d&&console.warn("setSelf function cannot be called in sync"),!d)return x(e,...t)}),l}});return E(e,t,u,()=>null==r?void 0:r.abort())}catch(t){return y(e,t,u)}finally{d=!1}},M=e=>{let t=n.get(e);return t||(t=O(e)),t},j=(e,t)=>!t.l.size&&(!t.t.size||1===t.t.size&&t.t.has(e)),N=e=>{let t=n.get(e);t&&j(e,t)&&P(e)},T=e=>{let t=new Map,r=new WeakMap,i=e=>{var t;let r=new Set(null==(t=n.get(e))?void 0:t.t);return l.forEach((t,n)=>{var l;(null==(l=o(n))?void 0:l.d.has(e))&&r.add(n)}),r},a=e=>{i(e).forEach(n=>{n!==e&&(t.set(n,(t.get(n)||new Set).add(e)),r.set(n,(r.get(n)||0)+1),a(n))})};a(e);let s=e=>{i(e).forEach(n=>{var l;if(n!==e){let e=r.get(n);if(e&&r.set(n,--e),!e){let e=!!(null==(l=t.get(n))?void 0:l.size);if(e){let t=o(n),r=S(n,!0);e=!t||!v(t,r)}e||t.forEach(e=>e.delete(n))}s(n)}})};s(e)},C=(t,...r)=>{let n=!0,l=t.write(e=>b(S(e)),(r,...l)=>{let a;if(r===t){if(!i(r))throw Error("atom not writable");let e=o(r),t=E(r,l[0]);e&&v(e,t)||T(r)}else a=C(r,...l);if(!n){let t=k();e.forEach(e=>e({type:"async-write",flushed:t}))}return a},...r);return n=!1,l},x=(t,...r)=>{let n=C(t,...r),l=k();return e.forEach(e=>e({type:"write",flushed:l})),n},O=(e,r,l)=>{var i;let s=l||[];null==(i=o(e))||i.d.forEach((t,r)=>{let l=n.get(r);l?l.t.add(e):r!==e&&O(r,e,s)}),S(e);let u={t:new Set(r&&[r]),l:new Set};if(n.set(e,u),t.add(e),a(e)&&e.onMount){let{onMount:t}=e;s.push(()=>{let r=t((...t)=>x(e,...t));r&&(u.u=r)})}return l||s.forEach(e=>e()),u},P=e=>{var r;let l=null==(r=n.get(e))?void 0:r.u;l&&l(),n.delete(e),t.delete(e);let i=o(e);i?(w(i)&&d(i.v),i.d.forEach((t,r)=>{if(r!==e){let t=n.get(r);t&&(t.t.delete(e),j(r,t)&&P(r))}})):console.warn("[Bug] could not find atom state to unmount",e)},A=(e,t,r)=>{let l=new Set(t.d.keys());null==r||r.forEach((t,r)=>{if(l.has(r)){l.delete(r);return}let o=n.get(r);o&&(o.t.delete(e),j(r,o)&&P(r))}),l.forEach(t=>{let r=n.get(t);r?r.t.add(e):n.has(e)&&O(t,e)})},k=()=>{let e;for(e=new Set;l.size;){let t=Array.from(l);l.clear(),t.forEach(([t,r])=>{let l=o(t);if(l){let o=n.get(t);o&&l.d!==(null==r?void 0:r.d)&&A(t,l,null==r?void 0:r.d),o&&!(r&&!w(r)&&(v(r,l)||g(r,l)))&&(o.l.forEach(e=>e()),e.add(t))}else console.warn("[Bug] no atom state to flush")})}return e};return{get:e=>b(S(e)),set:x,sub:(t,r)=>{let n=M(t),l=k(),o=n.l;return o.add(r),e.forEach(e=>e({type:"sub",flushed:l})),()=>{o.delete(r),N(t),e.forEach(e=>e({type:"unsub"}))}},dev_subscribe_store:(t,r)=>{if(2!==r)throw Error("The current StoreListener revision is 2.");return e.add(t),()=>{e.delete(t)}},dev_get_mounted_atoms:()=>t.values(),dev_get_atom_state:e=>r.get(e),dev_get_mounted:e=>n.get(e),dev_restore_atoms:t=>{for(let[e,r]of t)i(e)&&(E(e,r),T(e));let r=k();e.forEach(e=>e({type:"restore",flushed:r}))}}};"number"==typeof globalThis.__NUMBER_OF_JOTAI_INSTANCES__?++globalThis.__NUMBER_OF_JOTAI_INSTANCES__:globalThis.__NUMBER_OF_JOTAI_INSTANCES__=1;let m=()=>(n||(1!==globalThis.__NUMBER_OF_JOTAI_INSTANCES__&&console.warn("Detected multiple Jotai instances. It may cause unexpected behavior with the default store. https://github.com/pmndrs/jotai/discussions/2044"),n=p()),n);var E=r(7294);let y=(0,E.createContext)(void 0),S=e=>{let t=(0,E.useContext)(y);return(null==e?void 0:e.store)||t||m()},M=e=>"function"==typeof(null==e?void 0:e.then),j=E.use||(e=>{if("pending"===e.status)throw e;if("fulfilled"===e.status)return e.value;if("rejected"===e.status)throw e.reason;throw e.status="pending",e.then(t=>{e.status="fulfilled",e.value=t},t=>{e.status="rejected",e.reason=t}),e}),N=function(e,t){let r=`atom${++o}`,n={toString:()=>r};return"function"==typeof e?n.read=e:(n.init=e,n.read=e=>e(n),n.write=(e,t,r)=>t(n,"function"==typeof r?r(e(n)):r)),t&&(n.write=t),n}(0);var T=()=>{var e;let t=[],r=[],[n,o]=[function(e,t){let r=S(t),[[n,l,o],i]=(0,E.useReducer)(t=>{let n=r.get(e);return Object.is(t[0],n)&&t[1]===r&&t[2]===e?t:[n,r,e]},void 0,()=>[r.get(e),r,e]),a=n;(l!==r||o!==e)&&(i(),a=r.get(e));let s=null==t?void 0:t.delay;return(0,E.useEffect)(()=>{let t=r.sub(e,()=>{if("number"==typeof s){setTimeout(i,s);return}i()});return i(),t},[r,e,s]),(0,E.useDebugValue)(a),M(a)?j(a):a}(N,e),function(e,t){let r=S(t),n=(0,E.useCallback)((...t)=>{if(!("write"in e))throw Error("not writable atom");return r.set(e,...t)},[r,e]);return n}(N,e)],[i,a]=(0,E.useState)(null),s=Date.now(),u=e=>{let n=e.target.value,l=null==n?void 0:n.getUint16(1,!0);if(null==n){console.error("No value received from characteristic");return}void 0!==l&&function(e){let n=Date.now();if(e>0&&(s=n),n-s>=15e3){t.length=0,r.length=0;return}for(t.push(e),r.push(n);r[0]<n-2e3;)r.shift(),t.shift()}(l);let i=function(){let e=Array.from(new Set(t)),n=e[0],l=e.map(e=>e-n),o=l.reduce((e,t)=>e+t,0),i=o/(r.length/1e3);return i}();console.log("Current RPM:",i);let a=Math.floor(i);console.log("最終的な値 RPM:",a),o(a)};async function d(){try{let e=await navigator.bluetooth.requestDevice({filters:[{services:["00001816-0000-1000-8000-00805f9b34fb"]}],optionalServices:["0000180f-0000-1000-8000-00805f9b34fb"]});console.log("1",e);let t=await e.gatt.connect();console.log("2",t);let r=await t.getPrimaryService("00001816-0000-1000-8000-00805f9b34fb");console.log("3",r);let n=await t.getPrimaryService("0000180f-0000-1000-8000-00805f9b34fb"),l=await n.getCharacteristic("00002a19-0000-1000-8000-00805f9b34fb"),o=await l.readValue(),i=o.getUint8(0);console.log("Battery Level:",i),a(i);let s=document.getElementById("batteryLevel");null!==s&&(s.textContent="バッテリー残量: ".concat(i,"%")),await new Promise(e=>setTimeout(e,1e3));let d=await r.getCharacteristic("00002a5b-0000-1000-8000-00805f9b34fb");console.log("4",d),d.addEventListener("characteristicvaluechanged",u),await d.startNotifications(),console.log("5",d)}catch(e){console.error("Error:",e)}}return(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{children:"ケーデンスセンサーの読み取り"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{children:" 1.センサーに接続ボタンをクリックするとデバイス検索が入る"}),(0,l.jsx)("p",{children:"2.ペア設定をクリックするとデバイスが読み取られる"}),(0,l.jsx)("p",{children:"3.回転するとデータが更新されていく"})]}),(0,l.jsx)("button",{onClick:d,children:"センサーに接続"}),null!==i?(0,l.jsxs)("span",{id:"batteryLevel",children:["バッテリー残量: ",i,"%"]}):(0,l.jsx)("span",{id:"batteryLevel",children:"バッテリー残量: ---%"}),(0,l.jsxs)("p",{children:["RPM:",n]})]})}}},function(e){e.O(0,[774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);